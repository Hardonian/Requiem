# .github/dependabot.yml
#
# Dependabot configuration for Requiem.
#
# IMPORTANT: All Dependabot PRs must be reviewed against contracts/deps.allowlist.json.
# If a Dependabot PR bumps a dependency to a new major version, the allowlist entry
# must be updated in the same PR. The CI governance job (verify_deps.sh +
# verify_snapshot_diff.sh) will block merge if an unapproved dep appears.
#
# Processes:
#   1. Dependabot opens PR with version bump.
#   2. CI runs: verify_deps.sh confirms dep is in allowlist.
#   3. CI runs: verify_snapshot_diff.sh confirms no new dep added outside allowlist.
#   4. Reviewer checks: license unchanged, no breaking API changes.
#   5. If dep is new (not a version bump): update contracts/deps.allowlist.json first.

version: 2
updates:
  # ---------------------------------------------------------------------------
  # Node.js — ready-layer (Next.js / React dashboard)
  # ---------------------------------------------------------------------------
  - package-ecosystem: "npm"
    directory: "/ready-layer"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "UTC"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "node"
    # Only security updates for major version bumps; allow patch/minor automatically.
    # Major version bumps require manual allowlist update.
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]
    commit-message:
      prefix: "deps(node)"
      include: "scope"

  # ---------------------------------------------------------------------------
  # GitHub Actions — workflow action version pinning
  # ---------------------------------------------------------------------------
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "06:30"
      timezone: "UTC"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "github-actions"
    commit-message:
      prefix: "deps(actions)"
      include: "scope"
